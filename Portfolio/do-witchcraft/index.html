<!--
    Welcome to my website!
    If you're seeing this message on the dev console, 
    then you must be here to find which font I used.
    Feel free to grab that right below :D
    - Gavin_

    Hosted at: github.com/SilvRHat/gzimm4.github.io
-->
<!DOCTYPE html>
<html>
    <head>
        <title>Do Witchcraft</title>
        <link rel="icon" href="../../favicon.ico">
        <link rel="stylesheet" href="../../style.css">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300&family=Noto+Serif+JP:wght@300;400&family=Shippori+Mincho&display=swap" rel="stylesheet">
    </head>
    <body>
        <!-- HEADER -->
        <div class="navbar">
            <a class="home" href="../..">
                <h1>Gavin Zimmerman<img class='logo' src="../../img/logo.png"></h1>
                <h2>Technical Art · Direction // Programming</h2>
            </a>
            <div class="content">
                <div class="dropdown">
                    <a href=""><h3>Tech Art</h3></a>
                    <div class="dropdown-content">
                        <a href="../do-witchcraft/">Do Witchcraft</a><br>
                        <a href="../Ukiyo/">Project::Ukiyo「浮世」</a><br>
                        <a href="../grav-flux/">Gr@v:f/UX</a><br>
                        <a href="../blackhole/">BlackH01e</a><br>
                        <a href="../SPdr/">SP//dr_wbs</a><br>
                        <a href="../Ramen/">Tech·Katsu:Ramen</a><br>
                    </div>
                </div>
                <div class="dropdown">
                    <a href=""><h3>Project</h3></a>
                    <div class="dropdown-content">
                        <a href="../MvRE/">Mv:RE(Rendering Engine)</a><br>
                        <a href="../noir/">Noir~ Game</a><br>
                        <a href="../Diced/">Diced</a><br>
                        <a href="../light-stealer/">Light Stealer</a><br>
                    </div>
                </div>
                <div class="dropdown">
                    <a href="../../Profile/"><h3>Profile</h3></a>
                </div>
                <div class="dropdown">
                    <a href="../../Archive/"><h3>Archive</h3></a>
                </div>
            </div>
        </div>

        <!-- COVER -->
        <div class="cover-fit">
            <img src="../../img/cover.png">
            <div class="vert_title">
                <h2 style="color:rgb(16, 16, 16);">Do Witchcraft</h2>
            </div>
        </div>


        <!-- MAIN -->
        <div class="scroll">
            <!-- youtube -->
            <div class="content-2">
                <div class="info-box">
                    <h2>Do Witchcraft</h2>
                    <img><br>

                    <table style="text-align: center; margin: auto;">
                        <tr>
                            <td><strong>Producers:</strong></td>
                            <td><small>Gavin Zimmerman</small></td>
                        </tr>
                        <tr>
                            <td><strong>Developed:</strong></td>
                            <td><small>May 2022 - June 2022</small></td>
                        </tr>
                        <tr>
                            <td><strong>Media:</strong></td>
                            <td><small>Realtime VFX</small></td>
                        </tr>
                        <tr>
                            <td><strong>Tech:</strong></td>
                            <td><small>Blender 3.1</small></td>
                        </tr>
                        <tr>
                            <td><strong>Links:</strong></td>
                            <td><small>N/A</small></td>
                        </tr>
                    </table>

                    <h3>Table of Contents</h3>
                    <ul>
                        <li><a href="#project">Do Witchcraft</a>
                            <ul>
                                <li><a href="#video">Video</a></li>
                                <li><a href="#about">About</a></li>
                            </ul>
                        </li>
                        <li><a href="#breakdown">Breakdown</a>
                            <ul>
                                <li><a href="#sdf">Magic Card SDFs</a></li>
                                <li><a href="#lm">Light Magic</a>
                                    <uL>
                                        <li><a href="#l-concept">Concept Breakdown</a></li>
                                        <li><a href="#l-frag">Shaders (Fragment)</a></li>
                                        <li><a href="#l-geom">Geometry</a></li>
                                    </uL>
                                </li>
                                <li><a href="#im">Ice Magic</a>
                                    <uL>
                                        <li><a href="#i-concept">Concept Breakdown</a></li>
                                        <li><a href="#i-frag">Shaders (Fragment)</a></li>
                                        <li><a href="#i-geom">Geometry</a></li>
                                    </uL>
                                </li>
                                <li><a href="#pm">Plant Magic</a>
                                    <uL>
                                        <li><a href="#p-concept">Concept Breakdown</a></li>
                                        <li><a href="#p-frag">Shaders (Fragment)</a></li>
                                        <li><a href="#p-geom">Geometry</a></li>
                                    </uL>
                                </li>
                                <li><a href="#fm">Fire Magic</a>
                                    <uL>
                                        <li><a href="#f-concept">Concept Breakdown</a></li>
                                        <li><a href="#f-frag">Shaders (Fragment)</a></li>
                                        <li><a href="#f-geom">Geometry</a></li>
                                    </uL>
                                </li>
                                <li><a href="#render">Rendering</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <h1 id="project">Do Witchcraft (Current Project)</h1>
                <div id="video" class="project-reel">
                    <iframe style="aspect-ratio: 560/315; width: 100%;" src="https://www.youtube.com/embed/c3052u2BIJM" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>

                <h2 id="about">About</h2>
                Do Witchcraft is a personal project to explore/practice SDFs, bezier curves, animation curves,
                procedural geometry, timing, and of course magic. The concept is taken from "The Owl House"
                animation series by Dana Terrace and produced by Disney Television Animation.
                <br><br>
                Each card contains a glyph/symbol on them responsible for performing a spell,
                with four base symbols for: light, ice, plant, and fire magic.
                <br><br>
                These effects are recreated entirely procedurally in Blender using both Shader Nodes and Geometry Nodes.
                A handle (empty object) is then mapped to the Z-axis of each card, which is used as a custom timeline for the animation (Z Position = time).
                This makes queuing an animation customizable and also allows the user to move the timeline themselves for fun.
                In both shader and geometry programs, float curve nodes are used for each individual animation component including
                movements, sizing, instancing and more.

                <h1 id="breakdown">Breakdown</h1>
                As usual with my projects, I've provided a breakdown containing the design choices, method of approach,
                and a technical explanation of the key components. 
                At the very bottom is a new section on the iteration of test renders - as it explains how I approach rendering
                and iteration in this step of the project.
                <br><br>
                Since this isn't a full tutorial, I don't breakdown things like animating the handles responsible for driving
                each VFX timeline or a piece on customizing blender settings for a tech art workflow. 
                However, if you as a reader have any questions about the process or content here then please don't hesitate to ask.
                <br><br>

                <h2 id="sdf">Magic Card SDFs</h2>
                This first step is to create the cards themselves. 
                The geometry here is fairly simple - and only requires a plane (which may be subdivided later for deforming the card).
                Thus, the first major challenge is to texture the glyph pattern onto each card.
                <br><br>
                Because each glyph pattern features only simple geometry (line, circle, triangle, quadratic bezier curve, etc), we can generate SDFs mathematically to represent the patterns.
                An SDF is a signed distance field, where each position or fragment (in glsl terms) holds a signed value. 
                The values of every position make up a field, which then can make up a shape. For example a voronoi texture is an SDF representing the distance to the closest points.
                <br><br>
                SDF's may also be combined with maximum and mimimum operations for intersections and unions.
                So from SDFs of circles, lines, (quad) bezier curves, and triangles we'll be able to generate a SDF for the glyph patterns.
                <br><br>
                <img width="99%" src="img/sdf.png">
                <br><br>
                For this breakdown, I'll touch on the making of the Ice glyph (second from the left).

                <h3>Circle SDF</h3>
                The SDF for a circle is very simple - it is simply the length from the circle's center. 
                However, we want this SDF to be hollow. This can be done by subtracting the radius of the circle and then taking the absolute value of that.
                What happens is at radius R where the SDF value would be equal to R, after the subtraction the value is then 0. 
                Taking the absolute value, then inverses the inner part of the circle so that its positive.
                <br><br>
                <img width="99%" src="img/circle-sdf.png">
                <br><br>
                The center here so happens to be at (0,0) - but using the distance operation instead of the length operation can be used to offset the circle.
                <br><br>
                <h3>Rectangle SDF</h3>
                For the rotated square in the middle, I use a rectangle SDF since it allows for easier customization over 4 line SDFs.
                This is also fairly simple and demonstrates the technique for combining SDFs. 
                <br><br>
                For customization, we let the SDF function take in parameters for width and height. 
                For positioning, lets assume the center is always at (0,0) - the passed in coordinates to this SDF function can be changed to offset its location.
                <br><br>
                Now similar to the circle, 0 should be the value at each edge. The idea is to do this for each edge - which is simply offsetting the coordinate system 4 ways.
                Maximum operations can then be used for unioning.
                <br><br>
                <img width="23%" src="img/r0.png">
                <img width="24%" src="img/r1.png">
                <img width="23%" src="img/r2.png">
                <img width="23%" src="img/r3.png">
                <br><br>

                <h3>Line SDFs (simple and quadratic bezier)</h3>
                Some SDFs are significantly more mathmatical. 
                A line with rounded edges for example has 3 different cases for what the distance may be - and a bezier curve is a bezier curve.
                Luckily, such mathematical functions are readily available on the <a tagrte="_blank" href="https://iquilezles.org/articles/distfunctions/">internet</a>.
                Just be prepared to transcribe glsl code to blender nodes - which may only be readble in mathmatical notation.
                <br><br>
                <img width="96%" src="img/bezier-sdf.png">
                <br><br>
                <h3>Putting it together</h3>
                To union SDFs, a minimum operation may be used. A smooth minimum operation can also result in smooth combinations of SDFs.
                For organization of the whole SDF into a readable node tree, we have the coordinate system (middle purple line) and distance field (middle grey line)
                pass through the entire tree where they are used as inputs and updated from outputs.
                <br><br>
                <img width="96%" src="img/nodes.png">
                

                
                <br><br><br>
                <h2 id="lm">Light Magic</h2>
                The first magic VFX is the light magic spell, which generates a ball of floating light.
                
                <br><br>
                <h3 id="l-concept">Concept Breakdown</h3>
                The light spell works by transforming the piece of paper the glyph is written on into a ball of light.
                The tranformation of geometry from a plane into a sphere cause the paper to look like its crumbling into a ball- whilst
                simultaneously emitting more and more light. The ball then levitates in the air - thus when the paper first starts crumbling
                it has already started levitating somewhat.
                <br><br>
                Below is a simple VFX storyboard. The left-most column is time, the next column is the frame, and then notes are placed on the right.
                <br><br>
                <img width="40%" src="img/light-st.png">

                
                <br><br>
                <h3 id="l-frag">Shaders (Fragment)</h3>
                There are two pieces of geometry to shader here- the paper and the ball of light. 
                Shaders or materials can often be a limited resource in game development; so allocating two materials here may be overkill in some contexts.
                This is just something to be aware of in practice, but not constrained here.
                <br><br>
                The light material is simply an emission material and nothing more (which may be used for many lit objects in a game).
                <br><br>
                For the paper, there is a bit more work here.
                <br>
                First, on creating the paper texture - the UV map is plugged into a 2D noise texture. 
                Note that the node here actually uses the 2D setting instead of the default 3D input which is more computationally expensive.
                The factor of this texture is then plugged into a color ramp.
                <br><br>
                This noise is then reused and overlayed (added) onto the glyph SDF mentioned in the earlier section. 
                A comparison operation is then used as a factor in blending the paper color and ink color.
                <br><br>
                <img width="99%" src="img/light1.png">
                <br><br>
                For the emission, we need some concept of time so that the emission can be applied at the correct time.
                We also want some easy way of mapping time to values.
                <br><br>
                For time, we'll create a uniform (attribute in blender)- how this is set will be explained in the geometry section (since it has to be done on the CPU side).
                For mapping time to values, we'll construct a setup of two map range nodes and a float curve.
                The float curve allows values to be customized (since these are animating the effects we want to be able to ease the effects via curves).
                The mapping ranges are then placed around this to map the time range to the float curve input and then remap its outputs correctly.<br><br>
                To organize all this, I created a group node which does no operations but makes hooking the nodes together easier.
                <br><br>
                <img width="99%" src="img/light2.png">
                <br><br>
                That wraps up the shaders for this effect - the next piece is animating the paper crumbling into a ball.

                <br><br>
                <h3 id="l-geom">Geometry</h3>
                The geometry trees for this project get quite big.
                <br><br>
                <img width="99%" src="img/big-geom.png">
                <br><br>
                So I've included a list of what is animated (components which change) as a simple breakdown. 
                The following text then iterates more on each animated value and component.
                <ul>
                    <li>Curve on edges
                        <ul>
                            <li>Radius of curve</li>
                            <li>How much of the edge is curved (factor)</li>
                        </ul>
                    </li>
                    <li>Crumble (Noise Height offset)
                        <ul>
                            <li>Amplitude</li>
                            <li>Roughness (Distortion)</li>
                        </ul>
                    </li>
                    <li>Float
                        <ul>
                            <li>Float Height</li>
                            <li>Oscillation Amount</li>
                        </ul>
                    </li>
                    <li>Scale of the big sphere</li>
                    <li>Particles
                        <ul>
                            <li>Scaling</li>
                            <li>Distance away</li>
                        </ul>
                    </li>
                </ul>
                <br><br>

                Before all else, in the geometry step we need to create the notion of a timeline as mentioned in the previous section.
                To do this, we use the Z coordinate of an empty (middle) parented under our light 3D object. This node tree (left) is the leftmost in our geometry tree,
                since we also use this value to animate the geometry. After which, it is mapped to an attribute in the modifier settings. 
                To do this, you must also create an attribute- which ultimately acts as a uniform to the shader (right).
                <br><br>
                <img width="52%" src="img/time-nodes.png">
                <img width="14%" src="img/empty.png">
                <img width="33%" src="img/mods.png">

                <br><br>
                Now onto deformation.
                <br><br>
                To properly deform the mesh, first we need vertices to represent the amount of detail we're looking for. 
                The default 4 will not cut it, thus the very first operation is to subdivide the mesh.
                <br><br>
                <img width="35%" src="img/g1.png">
                <br><br>
                Next we want to crumble the edges of the plane inwards. To start, lets design a 2D test model.
                <img width="99%" src="img/lg2.png">
                <br><br>
                Basically, we'll start by curving the end around some arbitrary circle. 
                The circle's size and where curving begins is animated, which allows for customization.
                <br><br>
                Our 3D scenario translates easily to our 2D model - we can consider the X value in the 2D model as the distance from the center of our paper geometry.
                The up value then doesn't change. 
                <br><br>
                Next, we must define where the circle (or curvature) begins. 
                To do this, we constrain the max X value in the 2D model it can be placed. 
                This is equal to the distance of the corners from the center - which is 1.7 here.
                <br><br>
                Next we create an animatable parameter which is the factor along this length that the circle is placed.
                Using the vertex position, we then want to find how much is curved and how much is flat of its distance from the center.
                <br><br>
                <img width="99%" src="img/node-bd1.png">
                <br><br>
                Next, we want to get the radius which is also animatable. For this parameter, the circumfrence may actually make more sense in terms of units and values
                since the paper is wrapped around the surface of the circle. 
                The animation parameter I use here is called 'curvature' and translates to how many radians the max length is wrapped up in. 
                So if its 2π, that mean wrapping the max length 1.7 will give a complete circle.
                <br><br>
                The amount its curved by can then be divided by the total length and multiplied by this parameter to get the angle to rotate by.
                <br><br>
                Rotation here is done by axis angle, where the axis is the in/out axis of our 2D model. 
                The rotated vector is at (0,0) and the center is at (0, radius). Afterwards, the flat component is added to produce the final position in the 2D model space.
                <br><br>
                <img width="99%" src="img/geom-bd2.png">
                <img width="99%" src="img/geom-bd3.png">
                <br><br>
                Next, we have to put this in 3D space via another axis angle rotation. 
                This time the axis is the up vector, the center is (0,0), and the vector rotated in the result of the 2D model above. 
                The angle is determined via an azimuth angle generated from the oiginal position.
                <br><br>
                <img width="66%" src="img/geom-bd4.png">
                <img width="30%" src="img/geom-bd5.png">
                <br><br>
                Next, we add some noise to get a more realistic crumble. 
                For noise, we use the initial position and add the scene time to the Z axis - this lets the noise change over time.
                For animation parameters we want to animate: how much noise is applied, and how rough the noise is (change distortion).
                You'll also see there is an animation for the floating height in the following screenshot - this is done to condense
                setting the position once.
                <br><br>
                <img width="99%" src="img/geom-bd6.png">
                <br><br>
                There's also a related animation for how much to apply the oscillation effect.
                <br><br>
                <img width="70%" src="img/geom-bd7.png">
                <br><br>
                For other geometry, the instance on points geometry node is used to instance exisiting 3D models such as a glowing sphere.
                That geometry is then joined with the exisiting plane geometry and used as the final output geometry.
                <br><br>
                <img width="70%" src="img/geom-bd8.png">
                <br><br>
                For particles, random values are generated and used for direction, scale multiplier, and a distance multiplier.
                <br><br>
                <img width="50%" src="img/geom-bd9.png">                
                <br><br>
                And thats the first effect.





                <br><br><br>
                <h2 id="lm">Ice Magic</h2>

                <h3 id="i-concept">Concept Breakdown</h3>
                <h3 id="i-frag">Shaders (Fragment)</h3>
                <h3 id="i-geom">Geometry</h3>
                
                <!--
                <h2 id="lm">Plant Magic</h2>
                <h3 id="p-concept">Concept Breakdown</h3>
                <h3 id="p-frag">Shaders (Fragment)</h3>
                <h3 id="p-geom">Geometry</h3>
                <h2 id="lm">Fire Magic</h2>
                <h3 id="f-concept">Concept Breakdown</h3>
                <h3 id="f-frag">Shaders (Fragment)</h3>
                <h3 id="f-geom">Geometry</h3>
                -->
            </div>    
        </div>

        <!-- FOOTER -->
        <div class="footer">
            <div class="social-links">
                <a href = "https://www.artstation.com/silvrhat/profile" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 75.29 68.46"><path d="M7162.88,7218.5a.87.87,0,0,0-.78,1.25c1.79,3.59,6.4,13.75,12.4,13.75H7217a.86.86,0,0,0,.74-1.31l-8-13.27a.86.86,0,0,0-.74-.42Z" transform="translate(-7162.01 -7165.04)" style="fill:#fff"/><path d="M7192.13,7166.6l37.73,65.79a.8.8,0,0,0,1.35,0c2.11-3.29,8.29-10.93,5.29-17.93-1.76-4.11-23.65-41.47-26-45-4-6-14.08-4.28-17.74-4.08A.79.79,0,0,0,7192.13,7166.6Z" transform="translate(-7162.01 -7165.04)" style="fill:#fff"/><path d="M7169,7206.5h31.91a.9.9,0,0,0,.78-1.35l-16.41-28.27a.9.9,0,0,0-1.57,0l-15.5,28.26A.9.9,0,0,0,7169,7206.5Z" transform="translate(-7162.01 -7165.04)" style="fill:#fff"/></svg></a>
                <a href = "https://github.com/SilvRHat" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 59.75 66.55"><path d="M7188.5,7241.12V7232a.38.38,0,0,0-.45-.37c-2,.4-10.21,1.58-13.55-5.1-3-6-3.17-4.17-6-7a3.1,3.1,0,0,1-1-2s0-4,5,0,4,5,7,7c2.61,1.74,7.48,1.21,8.71,1a.37.37,0,0,0,.32-.3c.24-1.4,2-5.74,3-5.74s-18.31-.06-20-17a20.94,20.94,0,0,1,4.8-15.79.36.36,0,0,0,0-.44c-.64-1-2.78-4.89.16-10.77,1-2,8.78,1.89,11.88,3.92a.32.32,0,0,0,.27,0c1.38-.32,12.38-2.74,21.71,0a.37.37,0,0,0,.27,0c1.21-.65,10.79-5.73,11.87-3.93,2.65,4.41.62,9.6.11,10.76a.38.38,0,0,0,.08.42c1.1,1.08,6.51,7.11,3.81,18.82-2.45,10.6-13,13.72-18.28,14a.38.38,0,0,0-.28.6,18.57,18.57,0,0,1,2.56,4.42c.91,2.72.17,14.47,0,16.65a.37.37,0,0,1-.37.35h-21.27A.38.38,0,0,1,7188.5,7241.12Z" transform="translate(-7167.5 -7174.95)" style="fill:#fff"/></svg></a>
                <a href = "https://www.linkedin.com/in/gavinzimmerman/" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 73.69 73.49"><path d="M7203.91,7236.13H7188.7v-49h14.58v6.49l.19.06c.12-.15.27-.29.38-.45a15.34,15.34,0,0,1,11.38-7.16,22.76,22.76,0,0,1,10.2.86c4.76,1.5,7.67,4.82,9.21,9.45a34.16,34.16,0,0,1,1.56,10.66c.07,9.49.05,19,.06,28.49a5.15,5.15,0,0,1-.06.62H7221V7235c0-8.08,0-16.15,0-24.23a30,30,0,0,0-.61-5.76c-.73-3.67-3-5.52-6.74-5.72-2.85-.15-5.46.41-7.36,2.75a10,10,0,0,0-2.06,5.44c-.16,1.63-.26,3.27-.26,4.9,0,7.56,0,15.12,0,22.68Z" transform="translate(-7162.57 -7162.64)" style="fill:#fff"/><path d="M7163.86,7187.1H7179v49h-15.15Z" transform="translate(-7162.57 -7162.64)" style="fill:#fff"/><path d="M7171.43,7162.64a8.84,8.84,0,1,1-8.86,8.84A8.81,8.81,0,0,1,7171.43,7162.64Z" transform="translate(-7162.57 -7162.64)" style="fill:#fff"/></svg></a>
                <a href = "mailto: gzimm4@gmail.com" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 116 80"><polyline points="9 9 58 40 106 10" style="fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:10px"/><rect x="5" y="5" width="106" height="70" style="fill:none;stroke:#fff;stroke-miterlimit:10;stroke-width:10px"/></svg></a>
                <a href = "https://silvrship.dev/" target="_blank">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 124 62"><path d="M7178.92,7230.5h-9.42a31,31,0,0,1,0-62h9.82v15h-9.82a16,16,0,0,0,0,32h9.42v15Z" transform="translate(-7138.5 -7168.5)" style="fill:#fff"/><path d="M7231.5,7230.5h-13v-15h13a16,16,0,0,0,0-32h-13.4v-15h13.4a31,31,0,0,1,0,62Z" transform="translate(-7138.5 -7168.5)" style="fill:#fff"/><path d="M7231.5,7207h-65v-15h65Z" transform="translate(-7138.5 -7168.5)" style="fill:#fff"/></svg></a>
            </div>
            <div class="project-links">
                <a href="../do-witchcraft/">Do Witchcraft</a>
                <a href="../Ukiyo/">Project::Ukiyo「浮世」</a>
                <!--<a href="../Portfolio/Ramen/">Tech·Katsu:Ramen</a>-->
                <a href="../grav-flux/">Gr@v:f/UX</a>
                <a href="../blackhole/">BlackH01e</a>
                <a href="../SPdr/">SP//dr_wbs</a>
                <a href="../MvRE/">Mv:RE(Rendering Engine)</a>
            </div>
        </div>

    </body>
</html>